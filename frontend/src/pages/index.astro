---
import Layout from '../components/Layout.astro';
---

<Layout title="Loading..." currentPage="home">
  <div id="app">Loading...</div>
  
  <script>
    // API呼び出しでデータを取得
    fetch('/api/')
      .then(response => response.json())
      .then(data => {
        // Update page title
        document.title = `${data.appName} - Image Provenance Service`;
        
        document.getElementById('app').innerHTML = `
          <div class="hero min-h-96 bg-gradient-to-r from-primary to-secondary text-primary-content rounded-lg mb-8">
            <div class="hero-content text-center">
              <div class="max-w-md">
                <h1 class="mb-5 text-5xl font-bold">${data.appName}</h1>
                <p class="mb-5 text-xl">${data.description}</p>
                <div class="flex gap-4 justify-center items-center" id="hero-actions">
                  <a href="${data.links.signup}" class="btn btn-accent btn-lg" id="hero-signup">Get Started</a>
                  <a href="${data.links.login}" class="btn btn-outline btn-lg" id="hero-login">Login</a>
                  <a href="${data.links.verify}" class="btn btn-outline btn-lg">Verify</a>
                </div>
                <div class="hidden" id="hero-authenticated">
                  <a href="/mypage" class="btn btn-primary btn-lg">Go to My Page</a>
                </div>
              </div>
            </div>
          </div>
          <div class="card bg-base-100 shadow-xl mb-8">
            <div class="card-body">
              <h2 class="card-title text-2xl mb-4">What is ${data.appName}?</h2>
              <p class="text-lg mb-5">
                ${data.appName} Blueskyに投稿する画像の出所を証明するのに役立つサービスです
              </p>
              <p class="mb-5">以下の機能を提供します:</p>
              <ul class="list-disc list-inside text-left mb-5">
                ${data.features.map(feature => `<li>${feature}</li>`).join('')}
              </ul>
              <p class="mb-5">つかいかた:</p>
              <a href="${data.links.manual}" class="btn btn-primary btn-md">User Manual</a>
            </div>
          </div>
        `;
        
        // Check authentication status and update UI
        checkAuthAndUpdateHomeUI();
      })
      .catch(error => {
        document.title = 'Error - Image Provenance Service';
        document.getElementById('app').innerHTML = '<div class="alert alert-error"><span>Error loading data</span></div>';
      });
    
    function checkAuthAndUpdateHomeUI() {
      const accessToken = localStorage.getItem('access_token');
      const idToken = localStorage.getItem('id_token');
      const isAuthenticated = accessToken && idToken;
      
      if (isAuthenticated) {
        // Hide signup/login elements in hero
        const heroSignup = document.getElementById('hero-signup');
        const heroLogin = document.getElementById('hero-login');
        if (heroSignup) heroSignup.style.display = 'none';
        if (heroLogin) heroLogin.style.display = 'none';
        
        // Show authenticated elements
        const heroActions = document.getElementById('hero-actions');
        const heroAuth = document.getElementById('hero-authenticated');
        if (heroActions) heroActions.classList.add('hidden');
        if (heroAuth) heroAuth.classList.remove('hidden');
      }
    }
  </script>
</Layout>